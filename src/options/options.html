<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="options.css">
  <title>ChatGPT Options</title>
</head>
  <body>
    <header class="app-titlebar" role="banner">
      <h1 class="app-title">AI Suggested Replies for WhatsApp</h1>
    </header>
    <button id="menu-toggle" class="menu-toggle" aria-label="Toggle navigation">☰</button>
  <div class="options-container">
    <nav class="icon-bar" aria-label="Primary">
        <ul>
          <li><button class="icon-item active" data-tab="settings" aria-label="Settings" aria-current="page"><img src="../icons/Settings Gear.svg" alt="Settings icon"></button></li>
          <li><button class="icon-item" data-tab="history" aria-label="Logs / History"><img src="../icons/Logs.svg" alt="Logs icon"></button></li>
          <li><button class="icon-item" data-tab="guide" aria-label="User Guide"><img src="../icons/User Guide.svg" alt="User guide icon"></button></li>
          <li><button class="icon-item" data-tab="about" aria-label="About"><img src="../icons/About.svg" alt="About icon"></button></li>
          <li><button class="icon-item" data-tab="bugs" aria-label="Bug / Feature Request"><img src="../icons/Bug.svg" alt="Bug icon"></button></li>
          <li><button class="icon-item" data-tab="privacy" aria-label="Privacy"><img src="../icons/privacyicon.svg" alt="Privacy icon"></button></li>
          <li><button class="icon-item" data-tab="help" aria-label="Help"><img src="../icons/Help.svg" alt="Help icon"></button></li>
          <li><button class="icon-item" data-tab="references" aria-label="References">
            <img src="../icons/ReferencesIcon.svg" alt="References icon">
          </button></li>
        </ul>
        <!-- Bottom rail: theme toggle + branding -->
        <div class="rail-bottom">
          <div id="theme-toggle-wrapper">
            <button id="theme-toggle"
                    class="icon-item utility"
                    aria-label="Theme: Auto"
                    title="Theme: Auto"
                    style="border-left:none">
              <img src="../icons/DarkThemeSwitcherIcon.svg" alt="Theme toggle">
            </button>
          </div>
          <div class="extension-branding">
            <img src="../icons/Smart Replies for WhatsApp - SVG Logo.svg"
                 alt="Extension icon"
                 class="extension-icon">
          </div>
        </div>
      </nav>
    <nav id="sidebar" class="sidebar" aria-label="Main">
      <ul>
        <li><button class="nav-item active" data-tab="settings" aria-current="page">
          <span class="nav-title">Settings</span>
          <span class="nav-subtitle">Provider &amp; model</span>
        </button></li>
        <li><button class="nav-item" data-tab="history">
          <span class="nav-title">Logs / History</span>
          <span class="nav-subtitle">LLM call log</span>
        </button></li>
        <li><button class="nav-item" data-tab="guide">
          <span class="nav-title">User Guide</span>
          <span class="nav-subtitle">How it works</span>
        </button></li>
        <li><button class="nav-item" data-tab="about">
          <span class="nav-title">About</span>
          <span class="nav-subtitle">Extension info</span>
        </button></li>
        <li><button class="nav-item" data-tab="bugs">
          <span class="nav-title">Bug / Feature Request</span>
          <span class="nav-subtitle">Send feedback</span>
        </button></li>
        <li><button class="nav-item" data-tab="privacy">
          <span class="nav-title">Privacy</span>
          <span class="nav-subtitle">Policy &amp; Storage</span>
        </button></li>
        <li><button class="nav-item" data-tab="help">
          <span class="nav-title">Help</span>
          <span class="nav-subtitle">Support</span>
        </button></li>
        <li><button class="nav-item" data-tab="references">
          <span class="nav-title">References</span>
          <span class="nav-subtitle">API endpoints for popular LLMs</span>
        </button></li>
      </ul>
    </nav>
    <main id="main-content" class="main-content">
      <section id="settings" class="tab-content active" role="tabpanel">
        <h1 class="page-title">Settings</h1>
        <div id="quick-start" class="card quickstart" hidden>
          <h2>Quick Start</h2>
          <ol>
            <li>Choose a provider.</li>
            <li>Paste API key (if required).</li>
            <li>Click <strong>Save</strong>.</li>
            <li>Open WhatsApp Web.</li>
          </ol>
        </div>
        <form id="options-form">
          <fieldset id="provider-settings">
            <legend>Provider Settings</legend>

            <div class="provider-settings">
              <!-- Provider -->
              <label for="api-choice">Provider</label>
              <div class="stack">
                <select id="api-choice" name="api-choice">
                  <option value="openai">OpenAI</option>
                  <option value="openrouter">OpenRouter</option>
                  <option value="anthropic">Anthropic</option>
                  <option value="mistral">Mistral</option>
                  <option value="custom">Custom (OpenAI-compatible)</option>
                </select>
              </div>

              <!-- Model Name -->
              <label for="model-name">Model Name</label>
              <div class="stack">
                <input type="text" id="model-name" name="model-name" class="wide-input" placeholder="gpt-4o-mini">
                <p class="helper">Enter the model name exactly as supported by your provider. Leave blank for default.</p>
              </div>

              <!-- API Key -->
              <label for="api-key">API Key</label>
              <div class="stack">
                <div class="api-key-row">
                  <div class="api-key-wrap">
                    <input type="password" id="api-key" name="api-key" class="wide-input monospace api-key-input" aria-describedby="api-key-feedback">
                    <button type="button" id="toggle-api-key" aria-label="Show API key" class="eye-icon">
                      <img src="../icons/Eye Icon - Show Password.svg" alt="">
                    </button>
                  </div>
                  <button type="button" id="test-models" class="secondary-button">Test Models</button>
                </div>
                <div id="api-key-feedback" class="feedback" role="status" aria-live="polite"></div>
              </div>

              <!-- API Endpoint (read-only for built-ins, editable for Custom) -->
              <div id="endpoint-row">
                <label for="api-endpoint">API Endpoint</label>
                <div class="stack">
                  <input id="api-endpoint" class="api-key-input monospace" type="text" placeholder="http://localhost:1234/v1">
                  <div class="helper">Base URL (must end with <code>/v1</code>). Do NOT include <code>/chat/completions</code>.</div>
                </div>
              </div>

              <!-- Auth Header (show only for Custom; we’ll toggle via JS) -->
              <label for="auth-scheme" id="auth-scheme-label">Auth Header</label>
              <div class="stack" id="auth-scheme-field">
                <select id="auth-scheme">
                  <option value="none">No Auth header</option>
                  <option value="bearer">Authorization: Bearer &lt;key&gt;</option>
                  <option value="x-api-key">X-API-Key: &lt;key&gt;</option>
                </select>
              </div>
            </div>
          </fieldset>

          <fieldset id="context-settings">
            <legend>Context Settings</legend>

            <div class="form-row">
              <label for="context-message-limit">How many recent messages to send to the LLM as context:</label>
              <input id="context-message-limit" type="number" min="1" max="100" step="1" placeholder="10">
            </div>

            <div class="form-row">
              <label for="prompt-template">System Instructions</label>
              <textarea id="prompt-template" name="prompt-template" class="wide-input system-instructions-textarea" rows="12"></textarea>
            </div>
          </fieldset>

            <div id="improve-section" class="improve-section">
              <label for="show-advanced-improve">
                <input type="checkbox" id="show-advanced-improve">
                Show Advanced options for Improve-My-Response button
              </label>
            </div>

            <button type="submit" id="save-button" class="primary-button">Save</button>
            <button type="button" id="open-wa-web" class="primary-button" style="display:none">Open WhatsApp Web</button>
          </form>
        </section>
      <section id="history" class="tab-content" role="tabpanel">
        <h1 class="page-title">Logs / History</h1>
        <div class="history-header">
          <button id="download-csv" class="primary-button">Download CSV</button>
          <button id="clear-logs" class="danger-button" title="Delete all locally stored logs">Clear Logs</button>
        </div>
        <div id="llm-summary" class="summary-bar"></div>
          <div class="history-table-wrapper">
            <table id="history-table" class="history-table">
              <colgroup>
                <col class="col-ts">
                <col class="col-model">
                <col class="col-input">
                <col class="col-output">
                <col class="col-ptok">
                <col class="col-ctok">
                <col class="col-ttok">
                <col class="col-ttft">
                <col class="col-tps">
                <col class="col-rt">
              </colgroup>
              <thead>
                <tr>
                  <th>Timestamp</th>
                  <th>Model</th>
                  <th>Input Chat Data</th>
                  <th>Output Response</th>
                  <th>Prompt Tokens</th>
                  <th>Completion Tokens</th>
                  <th>Total Tokens</th>
                  <th>TTFT (ms)</th>
                  <th>Tok/s</th>
                  <th>Response Time (ms)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
      </section>
      <section id="guide" class="tab-content" role="tabpanel">
        <h1 class="page-title">User Guide</h1>
        <p>Use the extension to generate AI suggested replies for your chats.</p>
        <ol>
          <li>Open WhatsApp Web.</li>
          <li>Select a chat and type a message.</li>
          <li>Click the AI button to receive suggestions.</li>
        </ol>
      </section>
      <section id="about" class="tab-content" role="tabpanel">
        <h1 class="page-title">About</h1>
        <p>This open-source extension suggests replies using multiple AI providers.</p>
      </section>
      <section id="bugs" class="tab-content" role="tabpanel">
        <h1 class="page-title">Bug / Feature Request</h1>
        <p>Found an issue or have an idea? Visit our GitHub issues page to report bugs or request features.</p>
        <p><a href="https://github.com/PalWorks/AI-Suggested-Replies-For-WhatsApp/issues" target="_blank" rel="noopener">Open GitHub Issues</a></p>
      </section>
      <section id="privacy" class="tab-content" role="tabpanel">
        <h1 class="page-title">Privacy Policy</h1>
        <div class="policy-content">
          <p><strong>Privacy &amp; Data Storage</strong></p>
          <ul>
            <li>All logs and analytics (including LLM call history, error logs, and usage statistics) are stored <strong>locally</strong> in your browser via <code>chrome.storage.local</code>.</li>
            <li>No chat content, prompts, responses, API keys, or logs are transmitted to any external server by this extension.</li>
            <li>You can clear all local logs at any time from the “Logs / History” page.</li>
            <li>If you export logs, they remain on your device unless you share them.</li>
          </ul>
        </div>
      </section>
      <section id="help" class="tab-content" role="tabpanel">
        <h1 class="page-title">Help</h1>
        <p>Check the <a href="https://chrome.google.com/webstore/detail/chatgpt-answers-for-whats/bmbidjjfpkmlddlbkljbphdgpnjnpogk" target="_blank" rel="noopener">extension listing</a> for details and support.</p>
      </section>
      <section id="references" class="tab-content" role="tabpanel">
        <h1 class="page-title">References</h1>
        <p class="helper">API endpoints for popular LLMs.</p>
        <div class="references-table-wrapper">
          <table id="references-table" class="references-table">
            <colgroup>
              <col class="col-prov">
              <col class="col-model">
              <col class="col-date">
              <col class="col-endpoint">
            </colgroup>
            <thead>
              <tr>
                <th>Provider</th>
                <th>Model</th>
                <th>Release Date</th>
                <th>API Endpoint</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>
  <script type="module" src="options.js"></script>
</body>
</html>
